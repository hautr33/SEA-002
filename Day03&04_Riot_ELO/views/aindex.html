<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MMR Simulator</title>
  <style>
    body { font-family: sans-serif; padding: 30px; max-width: 600px; margin: auto; }
    select, button { font-size: 16px; margin: 5px 0; padding: 6px; width: 100%; }
    .result, .history { font-family: monospace; white-space: pre; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>ğŸ® MMR & Rank LP Simulator</h1>

  <label>Chá»n ngÆ°á»i chÆ¡i 1:</label>
  <select id="player1"></select>

  <label>Chá»n ngÆ°á»i chÆ¡i 2:</label>
  <select id="player2"></select>

  <button onclick="startMatch()">ğŸš€ Báº¯t Ä‘áº§u tráº­n Ä‘áº¥u (random ngÆ°á»i tháº¯ng)</button>

  <div class="result" id="result">â³ ChÆ°a cÃ³ tráº­n nÃ o...</div>
  <div class="history">
    <h3>Lá»‹ch sá»­ tráº­n Ä‘áº¥u</h3>
    <ul id="history" style="padding-left: 0;"></ul>
  </div>

  <script>
    let players = [];

    async function fetchPlayers() {
      const res = await fetch('/players');
      players = await res.json();

      const p1 = document.getElementById('player1');
      const p2 = document.getElementById('player2');

      p1.innerHTML = players.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
      p2.innerHTML = players.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
    }

    async function startMatch() {
      const id1 = parseInt(document.getElementById('player1').value);
      const id2 = parseInt(document.getElementById('player2').value);

      if (id1 === id2) {
        alert("âŒ Má»™t ngÆ°á»i khÃ´ng thá»ƒ Ä‘áº¥u vá»›i chÃ­nh mÃ¬nh!");
        return;
      }

      const winnerId = Math.random() < 0.5 ? id1 : id2;

      const res = await fetch('/match', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ player1Id: id1, player2Id: id2, winnerId })
      });

      const { result, players: updatedPlayers, history } = await res.json();

      document.getElementById('result').textContent = `
ğŸ† ${winnerId === id1 ? "NgÆ°á»i chÆ¡i 1" : "NgÆ°á»i chÆ¡i 2"} tháº¯ng!

ğŸ® ${updatedPlayers[0].name} - MMR: ${updatedPlayers[0].mmr}, LP: ${updatedPlayers[0].lp}, Rank: ${updatedPlayers[0].rank}
ğŸ® ${updatedPlayers[1].name} - MMR: ${updatedPlayers[1].mmr}, LP: ${updatedPlayers[1].lp}, Rank: ${updatedPlayers[1].rank}
      `.trim();

      renderHistory(history);
    }

    function renderHistory(history) {
      const ul = document.getElementById('history');
      ul.innerHTML = history.map(h => `
        <li>
          ğŸ•’ ${h.timestamp} â€“ ${h.winner} tháº¯ng ${h.loser}
          (MMR: +${h.mmrChangeA}/-${Math.abs(h.mmrChangeB)}, LP: +${h.lpChangeA}/-${Math.abs(h.lpChangeB)})
        </li>
      `).join('');
    }

    fetchPlayers();
  </script>
</body>
</html>
