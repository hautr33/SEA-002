<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>MMR Simulator</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 30px;
            max-width: 600px;
            margin: auto;
        }

        select,
        button {
            font-size: 16px;
            margin: 5px 0;
            padding: 6px;
            width: 100%;
        }

        .result,
        .history {
            font-family: monospace;
            white-space: pre;
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <h1>üéÆ MMR & Rank LP Simulator</h1>

    <label>Ch·ªçn ng∆∞·ªùi ch∆°i 1:</label>
    <select id="player1">
        <% players.forEach(p=> { %>
            <option value="<%= p.id %>">
                <%= p.name %>
            </option>
            <% }) %>
    </select>

    <label>Ch·ªçn ng∆∞·ªùi ch∆°i 2:</label>
    <<select id="player2">
        <% players.forEach(p=> { %>
            <option value="<%= p.id %>">
                <%= p.name %>
            </option>
            <% }) %>
                </select>

                <button onclick="startMatch()">üöÄ B·∫Øt ƒë·∫ßu tr·∫≠n ƒë·∫•u (random ng∆∞·ªùi th·∫Øng)</button>

                <div class="result" id="result">‚è≥ Ch∆∞a c√≥ tr·∫≠n n√†o...</div>
                <div class="history">
                    <h3>L·ªãch s·ª≠ tr·∫≠n ƒë·∫•u</h3>
                    <ul id="history" style="padding-left: 0;"></ul>
                </div>

                <script>
                    let players = [];

                    async function fetchPlayers() {
                        const res = await fetch('/players');
                        players = await res.json();

                        const p1 = document.getElementById('player1');
                        const p2 = document.getElementById('player2');

                        p1.innerHTML = players.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
                        p2.innerHTML = players.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
                    }
                    function startMatch() {
                        const id1 = parseInt(document.getElementById('player1').value);
                        const id2 = parseInt(document.getElementById('player2').value);
                        if (id1 === id2) return alert("Kh√¥ng th·ªÉ t·ª± ƒë·∫•u!");

                        fetch('/match', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ player1Id: id1, player2Id: id2, winnerId: Math.random() < 0.5 ? id1 : id2 })
                        })
                            .then(res => {
                                const { result, players: updatedPlayers, history } = res.json();

                                document.getElementById('result').textContent = `
üèÜ ${winnerId === id1 ? "Ng∆∞·ªùi ch∆°i 1" : "Ng∆∞·ªùi ch∆°i 2"} th·∫Øng!

üéÆ ${updatedPlayers[0].name} - MMR: ${updatedPlayers[0].mmr}, LP: ${updatedPlayers[0].lp}, Rank: ${updatedPlayers[0].rank}
üéÆ ${updatedPlayers[1].name} - MMR: ${updatedPlayers[1].mmr}, LP: ${updatedPlayers[1].lp}, Rank: ${updatedPlayers[1].rank}
      `.trim();

                                renderHistory(history);
                            })
                            .then(console.log);
                    }

                    function renderHistory(history) {
                        const ul = document.getElementById('history');
                        ul.innerHTML = history.map(h => `
        <li>
          üïí ${h.timestamp} ‚Äì ${h.winner} th·∫Øng ${h.loser}
          (MMR: +${h.mmrChangeA}/-${Math.abs(h.mmrChangeB)}, LP: +${h.lpChangeA}/-${Math.abs(h.lpChangeB)})
        </li>
      `).join('');
                    }

                    fetchPlayers();
                </script>
</body>

</html>